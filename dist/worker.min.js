/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cors-worker",t):e.CORSWorker=t()}(this,function(){"use strict";function e(e){return null===e?"null":void 0===e?"undefined":u.call(e).slice(8,-1).toLowerCase()}function t(n,r,o){if(c(r))for(var a,i=0,s=r.length;i<s;i++)t(n+"["+("object"===e(a=r[i])&&null!=a?i:"")+"]",a,o);else if("object"===e(r))for(var u in r)t(n+"["+u+"]",r[u],o);else o(n,r)}function n(e){e.onreadystatechange=null,e.onerror=null,e.ontimeout=null,e.onabort=null}function r(r,o){return o=o||{},o.cache=!1!==o.cache,o.headers=o.headers||{},o.data=o.hasOwnProperty("data")?function(n){function r(e,t){t="function"==typeof t?t():t,o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==t?"":t)}var o=[];if(c(n))for(var a,i=0,s=n.length;i<s;i++)r((a=n[i]).name,a.value);else{if("object"!==e(n))return String(n);for(var u in n)t(u,n[u],r)}return o.join("&")}(o.data):null,o.method=o.hasOwnProperty("method")?function(e){var t=(e=String(e)).toUpperCase();return h.indexOf(t)>-1?t:e}(o.method):"GET","GET"===o.method&&(null!==o.data&&(r+=l.test(r)?"&"+o.data:"?"+o.data),o.cache&&(r+=(l.test(r)?"&":"?")+p+"="+(+new Date+f++))),new Promise(function(e,t){function a(e){t(new TypeError("Request "+r+" "+e))}var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(n(i),e(i))},i.ontimeout=function(){n(i),a("timeout")},i.onabort=function(){n(i),a("aborted")},i.onerror=function(){n(i),a("failed")},i.open(o.method,r,!0,o.username,o.password);var s=o.headers;for(var u in s)s.hasOwnProperty(u)&&i.setRequestHeader(u,String(s[u]));i.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"===o.method&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),i.send("POST"===o.method?o.data:null)})}function o(e,t){return g+t+"-"+e+w}function a(e,t,n){return o(e,n)+JSON.stringify(t)+O}function i(e,t){this["<name>"]=String(e),this["<namespace>"]=String(t),this["<sources>"]={},this["<listeners>"]=[],this["<init>"]()}function s(){this["<init>"]()}var u=Object.prototype.toString,c=Array.isArray?function(e){return Array.isArray(e)}:function(t){return"array"===e(t)},d=/^([a-z0-9.+-]+:)?\/\/(?:[^/:]*(?::[^/]*)?@)?([^/]+)/i,f=0,l=/\?/,p=encodeURIComponent(""),h=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],m=document.documentElement,v="attachEvent"in m,y="addEventListener"in m,g="",w="",O="";return i.prototype["<init>"]=function(){function e(e){var i=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e)return n;return null}(e.source,n);if(null!==i){var s=e.data;if(function(e,t,n){return 0===t.indexOf(o(e,n))&&t.lastIndexOf(O)===t.length-1}(t,s,r)){var u=e.origin;s=function(e,t,n){t=t.slice(o(e,n).length,-1);try{return JSON.parse(t)}catch(r){return t}}(t,s,r);for(var c=0,d=a.length;c<d;c++)a[c]({data:s,origin:u,source:i})}}}var t=this["<name>"],n=this["<sources>"],r=this["<namespace>"],a=this["<listeners>"];y?window.addEventListener("message",e,!1):v&&window.attachEvent("onmessage",e)},i.prototype.add=function(e,t){this["<sources>"][e]=t},i.prototype.onmessage=function(e){this["<listeners>"].push(e)},i.prototype.send=function(e,t,n){e=String(e);var r=this["<sources>"],o=this["<namespace>"];if("*"===e)for(e in r)r.hasOwnProperty(e)&&r[e].postMessage(a(e,t,o),n);else r.hasOwnProperty(e)&&r[e].postMessage(a(e,t,o),n)},s.prototype["<init>"]=function(){var e=new i("Worker","CORS");e.add("Master",window.parent),e.onmessage(function(t){var n=t.data,o=t.origin,a=t.source;r(n.url,n.options).then(function(t){e.send(a,{valid:!0,uid:n.uid,data:t.responseText},o)})["catch"](function(t){e.send(a,{valid:!1,uid:n.uid,data:t.stack||t.message},o)})}),e.send("Master","ready",function(e){var t=d.exec(e);if(null===t)e=location.protocol+"//"+location.hostname+location.port;else{var n=t[1],r=t[2];e=(n||location.protocol)+"//"+r,"http"===n?e=e.replace(/:80$/,""):"https"===n&&(e=e.replace(/:443$/,""))}return e}(document.referrer))},s});
//# sourceMappingURL=worker.js.map