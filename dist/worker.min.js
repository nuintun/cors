/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cors-worker",t):e.CORSWorker=t()}(this,function(){"use strict";function e(e){return null===e?"null":void 0===e?"undefined":s.call(e).slice(8,-1).toLowerCase()}function t(n,r,o){if(u(r))for(var i,a=0,s=r.length;a<s;a++)t(n+"["+("object"===e(i=r[a])&&null!=i?a:"")+"]",i,o);else if("object"===e(r))for(var c in r)t(n+"["+c+"]",r[c],o);else o(n,r)}function n(n,r){return r=r||{},r.cache=!1!==r.cache,r.headers=r.headers||{},r.data=r.hasOwnProperty("data")?function(n){function r(e,t){t="function"==typeof t?t():t,o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==t?"":t)}var o=[];if(u(n))for(var i,a=0,s=n.length;a<s;a++)r((i=n[a]).name,i.value);else{if("object"!==e(n))return String(n);for(var c in n)t(c,n[c],r)}return o.join("&")}(r.data):null,r.method=r.hasOwnProperty("method")?function(e){var t=(e=String(e)).toUpperCase();return p.indexOf(t)>-1?t:e}(r.method):"GET","GET"===r.method&&(null!==r.data&&(n+=f.test(n)?"&"+r.data:"?"+r.data),r.cache&&(n+=(f.test(n)?"&":"?")+l+"="+(+new Date+d++))),new Promise(function(e,t){function o(e){t(new TypeError("Request "+n+" "+e))}var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&e(i)},i.ontimeout=function(){o("timeout")},i.onabort=function(){o("aborted")},i.onerror=function(){o("failed")},i.open(r.method,n,!0,r.username,r.password);var a=r.headers;for(var s in a)a.hasOwnProperty(s)&&i.setRequestHeader(s,String(a[s]));i.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"===r.method&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),i.send("POST"===r.method?r.data:null)})}function r(e,t){return y+t+"-"+e+g}function o(e,t,n){return r(e,n)+JSON.stringify(t)+w}function i(e,t){this["<name>"]=String(e),this["<namespace>"]=String(t),this["<sources>"]={},this["<listeners>"]=[],this["<init>"]()}function a(){this["<init>"]()}var s=Object.prototype.toString,u=Array.isArray?function(e){return Array.isArray(e)}:function(t){return"array"===e(t)},c=/^([a-z0-9.+-]+:)?\/\/(?:[^/:]*(?::[^/]*)?@)?([^/]+)/i,d=0,f=/\?/,l=encodeURIComponent(""),p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],h=document.documentElement,m="attachEvent"in h,v="addEventListener"in h,y="",g="",w="";return i.prototype["<init>"]=function(){function e(e){var a=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e)return n;return null}(e.source,n);if(null!==a){var s=e.data;if(function(e,t,n){return 0===t.indexOf(r(e,n))&&t.lastIndexOf(w)===t.length-1}(t,s,o)){var u=e.origin;s=function(e,t,n){t=t.slice(r(e,n).length,-1);try{return JSON.parse(t)}catch(o){return t}}(t,s,o);for(var c=0,d=i.length;c<d;c++)i[c]({data:s,origin:u,source:a})}}}var t=this["<name>"],n=this["<sources>"],o=this["<namespace>"],i=this["<listeners>"];v?window.addEventListener("message",e,!1):m&&window.attachEvent("onmessage",e)},i.prototype.add=function(e,t){this["<sources>"][e]=t},i.prototype.onmessage=function(e){this["<listeners>"].push(e)},i.prototype.send=function(e,t,n){e=String(e);var r=this["<sources>"],i=this["<namespace>"];if("*"===e)for(e in r)r.hasOwnProperty(e)&&r[e].postMessage(o(e,t,i),n);else r.hasOwnProperty(e)&&r[e].postMessage(o(e,t,i),n)},a.prototype["<init>"]=function(){var e=new i("Worker","CORS");e.add("Master",window.parent),e.onmessage(function(t){var r=t.data,o=t.origin,i=t.source;n(r.url,r.options).then(function(t){e.send(i,{valid:!0,uid:r.uid,data:t.responseText},o)})["catch"](function(t){e.send(i,{valid:!1,uid:r.uid,data:t.stack||t.message},o)})}),e.send("Master","ready",function(e){var t=c.exec(e);if(null===t)e=location.protocol+"//"+location.hostname+location.port;else{var n=t[1],r=t[2];e=(n||location.protocol)+"//"+r,"http"===n?e=e.replace(/:80$/,""):"https"===n&&(e=e.replace(/:443$/,""))}return e}(document.referrer))},a});
//# sourceMappingURL=worker.js.map