/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define("cors-worker",n):t.CORSWorker=n()}(this,function(){"use strict";function t(t){var n=s.exec(t);if(null===n)t=location.protocol+"//"+location.hostname+location.port;else{var e=n[1],i=n[2];t=(e||location.protocol)+"//"+i,"http"===e?t=t.replace(/:80$/,""):"https"===e&&(t=t.replace(/:443$/,""))}return t}function n(t,n){return a+n+"-"+t+c}function e(t,e,i){return n(t,i)+e+f}function i(t,n,e){return t=d+"-"+e+"-"+t,"function"==typeof n&&(window.navigator[t]=n),window.navigator[t]}function o(n,e,i,o){this.name=String(n),this.target=e,this.origin=t(i),this.namespace=o}function r(t,n){this.name=String(t),this.namespace=arguments.length>1?String(n):"Messenger",this.targets={},this.listens=[],this.init()}var s=/^([a-z0-9.+-]+:)?\/\/(?:[^/:]*(?::[^/]*)?@)?([^/]+)/i,a="",c="",f="",d="",u="postMessage"in window;o.prototype.send=u?function(t,n){console.log(n,"------",this.origin),this.target.postMessage(e(this.name,t,this.namespace),n)}:function(t,n){if("*"===n||n===this.origin){var o=i(this.name,this.namespace);if("function"!=typeof o)throw new Error("Target callback function is not defined");o({origin:this.origin,data:e(t)})}};var p="attachEvent"in window,h="addEventListener"in window;return r.prototype.init=function(){function t(t){var i=t.data;if(function(t,e,i){return 0===e.indexOf(n(t,i))&&e.lastIndexOf(f)===e.length-1}(e,i,o)){var s=t.origin;i=function(t,e,i){return e.slice(n(t,i).length,-1)}(e,i,o);for(var a=0,c=r.length;a<c;a++)r[a](i,s)}}var e=this.name,o=this.namespace,r=this.listens;u?h?window.addEventListener("message",t,!1):p&&window.attachEvent("onmessage",t):i(e,t,o)},r.prototype.add=function(t,n,e){this.targets[t]=new o(t,n,e,this.namespace)},r.prototype.listen=function(t){this.listens.push(t)},r.prototype.clear=function(){this.listens=[]},r.prototype.send=function(t,n,e){var i=this.targets;if(arguments.length>1)n=String(n),i.hasOwnProperty(n)&&i[n].send(t,e);else for(var o in i)i.hasOwnProperty(o)&&i[o].send(t,e)},function(){var n=new r("Worker");n.add("Master",window.parent,document.referrer),n.listen(function(t,e){var i=JSON.parse(t),o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&n.send(JSON.stringify({valid:!0,uid:i.uid,data:o.responseText}),"Master",e)},o.open("GET",i.url),o.send()}),n.send("ready","Master",t(document.referrer))}});
//# sourceMappingURL=worker.js.map