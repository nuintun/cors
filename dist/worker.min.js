/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cors-worker",t):e.CORSWorker=t()}(this,function(){"use strict";function e(e,t){return i+t+"-"+e+o}function t(t,n,r){return e(t,r)+JSON.stringify(n)+s}function n(e,t){this["<name>"]=String(e),this["<namespace>"]=String(t),this["<targets>"]={},this["<listeners>"]=[],this["<init>"]()}var r=/^([a-z0-9.+-]+:)?\/\/(?:[^/:]*(?::[^/]*)?@)?([^/]+)/i,i="",o="",s="",a=document.documentElement,u="attachEvent"in a,d="addEventListener"in a;return n.prototype["<init>"]=function(){function t(t){var o=t.data,a=t.origin;if(function(t,n,r){return 0===n.indexOf(e(t,r))&&n.lastIndexOf(s)===n.length-1}(n,o,r)){o=function(t,n,r){n=n.slice(e(t,r).length,-1);try{return JSON.parse(n)}catch(i){return n}}(n,o,r);for(var u=0,d=i.length;u<d;u++)i[u](o,a)}}var n=this["<name>"],r=this["<namespace>"],i=this["<listeners>"];d?window.addEventListener("message",t,!1):u&&window.attachEvent("onmessage",t)},n.prototype.add=function(e,t){this["<targets>"][e]=t},n.prototype.listen=function(e){this["<listeners>"].push(e)},n.prototype.send=function(e,n,r){e=String(e);var i=this["<targets>"],o=this["<namespace>"];if("*"===e)for(e in i)i.hasOwnProperty(e)&&i[e].postMessage(t(e,n,o),r);else i.hasOwnProperty(e)&&i[e].postMessage(t(e,n,o),r)},function(){var e=new n("Worker","CORS");e.add("Master",window.parent,document.referrer),e.listen(function(t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&e.send("Master",{valid:!0,uid:t.uid,data:r.responseText},n)},r.onerror=function(){e.send("Master",{valid:!1,uid:t.uid,data:"Request "+t.url+" failed"},n)},r.open("GET",t.url),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send()}),e.send("Master","ready",function(e){var t=r.exec(e);if(null===t)e=location.protocol+"//"+location.hostname+location.port;else{var n=t[1],i=t[2];e=(n||location.protocol)+"//"+i,"http"===n?e=e.replace(/:80$/,""):"https"===n&&(e=e.replace(/:443$/,""))}return e}(document.referrer))}});
//# sourceMappingURL=worker.js.map