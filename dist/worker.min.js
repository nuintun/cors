/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cors-worker",t):e.CORSWorker=t()}(this,function(){"use strict";function e(e,t){return a+t+"-"+e+u}function t(t,n,r){return e(t,r)+JSON.stringify(n)+c}function n(e,t){this["<name>"]=String(e),this["<namespace>"]=String(t),this["<sources>"]={},this["<listeners>"]=[],this["<init>"]()}var r=/^([a-z0-9.+-]+:)?\/\/(?:[^/:]*(?::[^/]*)?@)?([^/]+)/i,o=document.documentElement,i="attachEvent"in o,s="addEventListener"in o,a="",u="",c="";return n.prototype["<init>"]=function(){function t(t){var i=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e)return n;return null}(t.source,r);if(null!==i){var s=t.data;if(function(t,n,r){return 0===n.indexOf(e(t,r))&&n.lastIndexOf(c)===n.length-1}(n,s,o)){var u=t.origin;s=function(t,n,r){n=n.slice(e(t,r).length,-1);try{return JSON.parse(n)}catch(o){return n}}(n,s,o);for(var d=0,f=a.length;d<f;d++)a[d]({data:s,origin:u,source:i})}}}var n=this["<name>"],r=this["<sources>"],o=this["<namespace>"],a=this["<listeners>"];s?window.addEventListener("message",t,!1):i&&window.attachEvent("onmessage",t)},n.prototype.add=function(e,t){this["<sources>"][e]=t},n.prototype.onmessage=function(e){this["<listeners>"].push(e)},n.prototype.send=function(e,n,r){e=String(e);var o=this["<sources>"],i=this["<namespace>"];if("*"===e)for(e in o)o.hasOwnProperty(e)&&o[e].postMessage(t(e,n,i),r);else o.hasOwnProperty(e)&&o[e].postMessage(t(e,n,i),r)},function(){var e=new n("Worker","CORS");e.add("Master",window.parent),e.onmessage(function(t){var n=t.data,r=t.origin,o=t.source,i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&e.send(o,{valid:!0,uid:n.uid,data:i.responseText},r)},i.onerror=function(){e.send(o,{valid:!1,uid:n.uid,data:"Request "+n.url+" failed"},r)},i.open("GET",n.url),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send()}),e.send("Master","ready",function(e){var t=r.exec(e);if(null===t)e=location.protocol+"//"+location.hostname+location.port;else{var n=t[1],o=t[2];e=(n||location.protocol)+"//"+o,"http"===n?e=e.replace(/:80$/,""):"https"===n&&(e=e.replace(/:443$/,""))}return e}(document.referrer))}});
//# sourceMappingURL=worker.js.map