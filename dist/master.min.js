/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cors-master",e):t.CORSMaster=e()}(this,function(){"use strict";function t(){if(!document.body)return clearTimeout(c),c=setTimeout(t,1);for(var e=0;e<h.length;e++)h[e]();h=[]}function e(){document.removeEventListener("DOMContentLoaded",e,!1),t()}function n(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",n),t())}function o(){if(h.length>0){try{document.documentElement.doScroll("left")}catch(e){return setTimeout(o,1)}t()}}function i(t,e){return v+e+"-"+t+w}function r(t,e,n){return i(t,n)+JSON.stringify(e)+b}function a(t,e){this["<name>"]=String(t),this["<namespace>"]=String(e),this["<targets>"]={},this["<listeners>"]=[],this["<init>"]()}function s(t){this["<ready>"]=!1,this["<origin>"]=function(t){var e=g.exec(t);if(null===e)t=location.protocol+"//"+location.hostname+location.port;else{var n=e[1],o=e[2];t=(n||location.protocol)+"//"+o,"http"===n?t=t.replace(/:80$/,""):"https"===n&&(t=t.replace(/:443$/,""))}return t}(t),this["<callbacks>"]={ready:[]},this["<messenger>"]=this["<proxy>"](t)}var c,d=document.documentElement,u="attachEvent"in d,l="addEventListener"in d,f=!1,h=[],m=function(i){h.push(i),"complete"===document.readyState?t():f||(!function(){if(l)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",t,!1);else if(u){document.attachEvent("onreadystatechange",n),window.attachEvent("onload",t);var i=!1;try{i=null==window.frameElement}catch(r){}document.documentElement.doScroll&&i&&o()}}(),f=!0)},p=0,y=Object.prototype.toString,g=/^([a-z0-9.+-]+:)?\/\/(?:[^/:]*(?::[^/]*)?@)?([^/]+)/i,v="",w="",b="";return a.prototype["<init>"]=function(){function t(t){var r=t.data,a=t.origin;if(function(t,e,n){return 0===e.indexOf(i(t,n))&&e.lastIndexOf(b)===e.length-1}(e,r,n)){r=function(t,e,n){e=e.slice(i(t,n).length,-1);try{return JSON.parse(e)}catch(o){return e}}(e,r,n);for(var s=0,c=o.length;s<c;s++)o[s](r,a)}}var e=this["<name>"],n=this["<namespace>"],o=this["<listeners>"];l?window.addEventListener("message",t,!1):u&&window.attachEvent("onmessage",t)},a.prototype.add=function(t,e){this["<targets>"][t]=e},a.prototype.listen=function(t){this["<listeners>"].push(t)},a.prototype.send=function(t,e,n){t=String(t);var o=this["<targets>"],i=this["<namespace>"];if("*"===t)for(t in o)o.hasOwnProperty(t)&&o[t].postMessage(r(t,e,i),n);else o.hasOwnProperty(t)&&o[t].postMessage(r(t,e,i),n)},s.prototype={"<onready>":function(t){var e=this["<callbacks>"];this["<ready>"]?t():e.ready.push(t)},"<proxy>":function(t){var e=document.createElement("iframe");e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("frameborder","0"),e.setAttribute("marginwidth","0"),e.setAttribute("marginheight","0"),e.style.display="none",e.src=t;var n=this,o=n["<callbacks>"],i=new a("Master","CORS");return m(function(){document.body.appendChild(e),i.add("Worker",e.contentWindow),i.listen(function(t){if("ready"===t){if(!n["<ready>"]){n["<ready>"]=!0;for(var e=o.ready,i=0,r=e.length;i<r;i++)e[i]();delete o.ready}}else if("object"===function(t){return null===t?"null":void 0===t?"undefined":y.call(t).slice(8,-1).toLowerCase()}(t)){var a=t.uid;o[a]&&(o[a](t),delete o[a])}})}),i},request:function(t,e){var n=this,o=n["<origin>"],i=n["<callbacks>"],r=n["<messenger>"];return new Promise(function(a,s){var c="UID-"+p++;i[c]=function(t){t.valid?a(t.data):s(t.data)},n["<onready>"](function(){r.send("Worker",{uid:c,url:t,options:e},o)})})}},s});
//# sourceMappingURL=master.js.map