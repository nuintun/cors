/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cors-master",e):t.CORSMaster=e()}(this,function(){"use strict";function t(){if(!document.body)return clearTimeout(c),c=setTimeout(t,1);for(var e=0;e<h.length;e++)h[e]();h=[]}function e(){document.removeEventListener("DOMContentLoaded",e,!1),t()}function n(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",n),t())}function o(){if(h.length>0){try{document.documentElement.doScroll("left")}catch(e){return setTimeout(o,1)}t()}}function r(t,e){return p+e+"-"+t+y}function i(t,e,n){return r(t,n)+JSON.stringify(e)+v}function a(t,e){this["<name>"]=String(t),this["<namespace>"]=String(e),this["<sources>"]={},this["<listeners>"]=[],this["<init>"]()}function s(t){this["<ready>"]=!1,this["<origin>"]=function(t){var e=b.exec(t);if(null===e)t=location.protocol+"//"+location.hostname+location.port;else{var n=e[1],o=e[2];t=(n||location.protocol)+"//"+o,"http"===n?t=t.replace(/:80$/,""):"https"===n&&(t=t.replace(/:443$/,""))}return t}(t),this["<callbacks>"]={ready:[]},this["<messenger>"]=this["<proxy>"](t)}var c,u=document.documentElement,d="attachEvent"in u,l="addEventListener"in u,f=!1,h=[],m=function(r){h.push(r),"complete"===document.readyState?t():f||(!function(){if(l)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",t,!1);else if(d){document.attachEvent("onreadystatechange",n),window.attachEvent("onload",t);var r=!1;try{r=null==window.frameElement}catch(i){}document.documentElement.doScroll&&r&&o()}}(),f=!0)},p="",y="",v="";a.prototype["<init>"]=function(){function t(t){var a=function(t,e){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t)return n;return null}(t.source,n);if(null!==a){var s=t.data;if(function(t,e,n){return 0===e.indexOf(r(t,n))&&e.lastIndexOf(v)===e.length-1}(e,s,o)){var c=t.origin;s=function(t,e,n){e=e.slice(r(t,n).length,-1);try{return JSON.parse(e)}catch(o){return e}}(e,s,o);for(var u=0,d=i.length;u<d;u++)i[u]({data:s,origin:c,source:a})}}}var e=this["<name>"],n=this["<sources>"],o=this["<namespace>"],i=this["<listeners>"];l?window.addEventListener("message",t,!1):d&&window.attachEvent("onmessage",t)},a.prototype.add=function(t,e){this["<sources>"][t]=e},a.prototype.onmessage=function(t){this["<listeners>"].push(t)},a.prototype.send=function(t,e,n){t=String(t);var o=this["<sources>"],r=this["<namespace>"];if("*"===t)for(t in o)o.hasOwnProperty(t)&&o[t].postMessage(i(t,e,r),n);else o.hasOwnProperty(t)&&o[t].postMessage(i(t,e,r),n)};var g=0,w=Object.prototype.toString,b=/^([a-z0-9.+-]+:)?\/\/(?:[^/:]*(?::[^/]*)?@)?([^/]+)/i;return s.prototype={"<onready>":function(t){var e=this["<callbacks>"];this["<ready>"]?t():e.ready.push(t)},"<proxy>":function(t){var e=document.createElement("iframe");e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("frameborder","0"),e.setAttribute("marginwidth","0"),e.setAttribute("marginheight","0"),e.style.display="none",e.src=t;var n=this,o=n["<origin>"],r=n["<callbacks>"],i=new a("Master","CORS");return m(function(){document.body.appendChild(e),i.add("Worker",e.contentWindow),i.onmessage(function(t){if(t.origin===o){var e=t.data;if("ready"===e){if(!n["<ready>"]){n["<ready>"]=!0;for(var i=r.ready,a=0,s=i.length;a<s;a++)i[a]();delete r.ready}}else if("object"===function(t){return null===t?"null":void 0===t?"undefined":w.call(t).slice(8,-1).toLowerCase()}(e)){var c=e.uid;r[c]&&(r[c](e),delete r[c])}}})}),i},request:function(t,e){var n=this,o=n["<origin>"],r=n["<callbacks>"],i=n["<messenger>"];return new Promise(function(a,s){var c="UID-"+g++;r[c]=function(t){t.valid?a(t.data):s(t.data)},n["<onready>"](function(){i.send("Worker",{uid:c,url:t,options:e},o)})})}},s});
//# sourceMappingURL=master.js.map