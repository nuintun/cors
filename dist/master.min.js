/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cors-master",e):t.CORSMaster=e()}(this,function(){"use strict";function t(){if(!document.body)return clearTimeout(u),u=setTimeout(t);for(var e=0;e<l.length;e++)l[e]();l=[]}function e(){document.removeEventListener("DOMContentLoaded",e,!1),t()}function n(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",n),t())}function i(){if(l.length>0){try{document.documentElement.doScroll("left")}catch(e){return setTimeout(i,1)}t()}}function o(t,e){return p+e+"-"+t+y}function r(t,e,n){return o(t,n)+e+g}function a(t,e,n){return t=w+"-"+n+"-"+t,"function"==typeof e&&(window.navigator[t]=e),window.navigator[t]}function s(t,e,n){this.name=String(t),this.namespace=n,this.target=e}function c(t,e){this.name=String(t),this.namespace=arguments.length>1?String(e):"Messenger",this.targets={},this.listens=[],this.init()}function d(t){this["<ready>"]=!1,this["<callbacks>"]={ready:[]},this["<messenger>"]=this["<proxy>"](t)}var u,f=0,h=!1,l=[],m=function(o){l.push(o),"complete"===document.readyState?t():h||(!function(){if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",t,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",n),window.attachEvent("onload",t);var o=!1;try{o=null==window.frameElement}catch(r){}document.documentElement.doScroll&&o&&i()}}(),h=!0)},p="",y="",g="",w="",v="postMessage"in window,E="attachEvent"in window,b="addEventListener"in window;return s.prototype.send=v?function(t){this.target.postMessage(r(this.name,t,this.namespace),"*")}:function(t){var e=a(this.name,this.namespace);if("function"!=typeof e)throw new Error("Target callback function is not defined");e(r(t),window)},c.prototype.init=function(){function t(t){if("object"==typeof t&&t.data&&(t=t.data),function(t,e,n){return 0===e.indexOf(o(t,n))&&e.lastIndexOf(g)===e.length-1}(e,t,n)){t=function(t,e,n){return e.slice(o(t,n).length,-1)}(e,t,n);for(var r=0,a=i.length;r<a;r++)i[r](t)}}var e=this.name,n=this.namespace,i=this.listens;v?b?window.addEventListener("message",t,!1):E&&window.attachEvent("onmessage",t):a(e,t,n)},c.prototype.add=function(t,e){this.targets[t]=new s(t,e,this.namespace)},c.prototype.listen=function(t){this.listens.push(t)},c.prototype.clear=function(){this.listens=[]},c.prototype.send=function(t,e){var n=this.targets;if(arguments.length>1)e=String(e),n.hasOwnProperty(e)&&n[e].send(t);else for(var i in n)n.hasOwnProperty(i)&&n[i].send(t)},d.prototype={"<onready>":function(t){var e=this["<callbacks>"];this["<ready>"]?t():e.ready.push(t)},"<proxy>":function(t){var e=document.createElement("iframe");e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("frameborder","0"),e.setAttribute("marginwidth","0"),e.setAttribute("marginheight","0"),e.src=t;var n=this,i=n["<callbacks>"],o=new c("Master");return m(function(){document.body.appendChild(e),o.add("Worker",e.contentWindow),o.listen(function(t){if("ready"===t){if(!n["<ready>"]){n["<ready>"]=!0;for(var e=i.ready,o=0,r=e.length;o<r;o++)e[o]();delete i.ready}}else{try{t=JSON.parse(t)}catch(s){return console&&console.error&&console.error(t)}var a=t.uid;i[a]&&(i[a](t),delete i[a])}})}),o},request:function(t,e){var n=this,i=this["<callbacks>"],o=this["<messenger>"];return new Promise(function(r,a){var s="UID-"+f++;i[s]=function(t){t.valid?r(t.data):a(t.data)},n["<onready>"](function(){o.send(JSON.stringify({uid:s,url:t,options:e}),"Worker")})})}},d});
//# sourceMappingURL=master.js.map