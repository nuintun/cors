/**
* @module cors
* @author nuintun
* @license MIT
* @version 0.0.1
* @description A pure JavaScript CORS framework.
* @see https://nuintun.github.io/cors
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cors-master",e):t.CORSMaster=e()}(this,function(){"use strict";function t(t,e){return o+e+"-"+t+c}function e(e,n,i){return t(e,i)+n+d}function n(t,e,n){return t=u+"-"+n+"-"+t,"function"==typeof e&&(window.navigator[t]=e),window.navigator[t]}function i(t,e,n){this.name=String(t),this.namespace=n,this.target=e}function r(t,e){this.name=String(t),this.namespace=arguments.length>1?String(e):"Messenger",this.targets={},this.listens=[],this.init()}function s(t){this["<ready>"]=!1,this["<callbacks>"]={ready:[]},this["<messenger>"]=this["<proxy>"](t)}var a=0,o="",c="",d="",u="",h="postMessage"in window,f="attachEvent"in window,p="addEventListener"in window;return i.prototype.send=h?function(t){this.target.postMessage(e(this.name,t,this.namespace),"*")}:function(t){var i=n(this.name,this.namespace);if("function"!=typeof i)throw new Error("Target callback function is not defined");i(e(t),window)},r.prototype.init=function(){function e(e){if("object"==typeof e&&e.data&&(e=e.data),function(e,n,i){return 0===n.indexOf(t(e,i))&&n.lastIndexOf(d)===n.length-1}(i,e,r)){e=function(e,n,i){return n.slice(t(e,i).length,-1)}(i,e,r);for(var n=0,a=s.length;n<a;n++)s[n](e)}}var i=this.name,r=this.namespace,s=this.listens;h?p?window.addEventListener("message",e,!1):f&&window.attachEvent("onmessage",e):n(i,e,r)},r.prototype.add=function(t,e){this.targets[t]=new i(t,e,this.namespace)},r.prototype.listen=function(t){this.listens.push(t)},r.prototype.clear=function(){this.listens=[]},r.prototype.send=function(t,e){var n=this.targets;if(arguments.length>1)e=String(e),n.hasOwnProperty(e)&&n[e].send(t);else for(var i in n)n.hasOwnProperty(i)&&n[i].send(t)},s.prototype={ready:function(t){var e=this["<callbacks>"];this["<ready>"]?t():e.ready.push(t)},"<proxy>":function(t){var e=document.createElement("iframe");e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("frameborder","0"),e.setAttribute("marginwidth","0"),e.setAttribute("marginheight","0"),e.src=t,document.documentElement.appendChild(e);var n=this,i=this["<callbacks>"],s=new r("Master");return s.add("Worker",e.contentWindow),s.listen(function(t){if("ready"===t){if(!n["<ready>"]){n["<ready>"]=!0;for(var e=i.ready,r=0,s=e.length;r<s;r++)e[r]();delete i.ready}}else{try{t=JSON.parse(t)}catch(o){return console&&console.error&&console.error(t)}var a=t.uid;i[a]&&(i[a](t),delete i[a])}}),s},request:function(t,e){var n=this["<callbacks>"],i=this["<messenger>"];return new Promise(function(r,s){var o="UID-"+a++;n[o]=function(t){t.valid?r(t.data):s(t.data)},i.send(JSON.stringify({uid:o,url:t,options:e}),"Worker")})}},s});
//# sourceMappingURL=master.js.map